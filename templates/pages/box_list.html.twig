{% extends 'base.html.twig' %}

{% block title %}Liste des Boxs{% endblock %}

{% block body %}
<div class="page-wrapper">
    <div class="page-container">
        <div class="main-content">
            <div class="section__content section__content--p30">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="overview-wrap">
                                <h2 class="title-1">Liste des Boxs</h2>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                             <div class="form-group">
                                <label for="searchInput">Rechercher par attribut:</label>
                                <input type="text" class="form-control" id="searchInput" placeholder="Entrez un terme de recherche">
                            </div>
                            <div class="table-responsive table--no-card m-b-30">
                                <table class="table table-borderless table-striped table-earning">
                                    <thead>
                                        <tr>
                                            <th>Commune</th>
                                            <th>Localisation</th>
                                            <th>Adresse</th>
                                            <th>Ligne de Support</th>
                                            <th>Type</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for box in boxes %}
                                        <tr>
                                            <td>{{ box.commune }}</td>
                                            <td>{{ box.localisation }}</td>
                                            <td>{{ box.adresse }}</td>
                                            <td>{{ box.ligne_support }}</td>
                                            <td>{{ box.type }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        const allBoxes = {{ boxes | json_encode | raw }};
        let displayedBoxes = [...allBoxes];

        function renderBoxesTable(boxesToDisplay) {
            const tbody = document.querySelector('.table tbody');
            tbody.innerHTML = '';

            boxesToDisplay.forEach(box => {
                const row = `
                    <tr>
                        <td>${box.commune}</td>
                        <td>${box.localisation}</td>
                        <td>${box.adresse}</td>
                        <td>${box.ligne_support}</td>
                        <td>${box.type}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            renderBoxesTable(displayedBoxes);

            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function(event) {
                    const searchTerm = event.target.value.toLowerCase();
                    displayedBoxes = allBoxes.filter(box => {
                        for (const key in box) {
                            const value = box[key];
                            if (value !== null && value !== undefined && value.toString().toLowerCase().includes(searchTerm)) {
                                return true;
                            }
                        }
                        return false;
                    });
                    renderBoxesTable(displayedBoxes);
                });
            }
        });
    </script>
{% endblock %}