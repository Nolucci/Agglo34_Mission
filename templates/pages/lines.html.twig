{% extends './base.html.twig' %}

{% block title %}Informations des Lignes Téléphoniques{% endblock %}

{% block body %}
<div class="page-wrapper">
    <div class="page-container">
        <div class="main-content">
            <div class="section__content section__content--p30">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-3">
                            <div class="card">
                                <div class="card-header">
                                    <strong class="card-title">Statistiques des Lignes</strong>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled">
                                        <li>
                                            <i class="fa fa-phone"></i> Total des lignes : 
                                            <span class="badge badge-primary">{{ lines|length }}</span>
                                        </li>
                                        <li>
                                            <i class="fa fa-building"></i> Services uniques : 
                                            <span class="badge badge-info">{{ phoneLineStats.unique_services }}</span>
                                        </li>
                                        <li>
                                            <i class="fa fa-signal"></i> Opérateurs : 
                                            <span class="badge badge-success">{{ phoneLineStats.unique_operators }}</span>
                                        </li>
                                        <li>
                                            <i class="fa fa-globe"></i> Lignes globales : 
                                            <span class="badge badge-warning">{{ phoneLineStats.global_lines }}</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="card mt-3">
                                <div class="card-header">
                                    <strong class="card-title">Carte des Lignes</strong>
                                </div>
                                <div class="card-body">
                                    <div id="map-agglomeration" style="height: 300px; width: 100%; border: 1px solid #ccc;"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-9">
                            <div class="card">
                                <div class="card-header">
                                    <strong class="card-title">Liste des Lignes Téléphoniques</strong>
                                    <button class="btn btn-sm btn-primary float-right" data-toggle="modal" data-target="#lignesFiltersModal">
                                        <i class="fa fa-filter"></i> Filtres
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Localisation</th>
                                                    <th>Service</th>
                                                    <th>Attribué à</th>
                                                    <th>Opérateur</th>
                                                    <th>Type de Ligne</th>
                                                    <th>Municipalité</th>
                                                    <th>Statut</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for line in lines %}
                                                <tr>
                                                    <td>{{ line.location }}</td>
                                                    <td>{{ line.service }}</td>
                                                    <td>{{ line.assignedTo }}</td>
                                                    <td>{{ line.operator }}</td>
                                                    <td>{{ line.lineType }}</td>
                                                    <td>{{ line.municipality }}</td>
                                                    <td>
                                                        {% if line.isGlobal %}
                                                            <span class="badge badge-success">Global</span>
                                                        {% else %}
                                                            <span class="badge badge-secondary">Local</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% include './modals/_lines_filters_modal.html.twig' with { phoneLines: lines } %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        // Initialisation de la carte des lignes
        function initMap() {
            // Logique de la carte à implémenter
        }
    </script>
{% endblock %}
