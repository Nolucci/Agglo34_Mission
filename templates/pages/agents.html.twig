{% extends './base.html.twig' %}

{% block title %}Agents{% endblock %}

{% block body %}
    <div class="page-wrapper">
        <div class="page-container">
            <div class="main-content">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-lg-3">
                                <div class="card">
                                    <div class="card-header">
                                        <strong class="card-title">Statistiques des Agents</strong>
                                    </div>
                                    <div class="card-body text-center">
                                        <ul class="list-unstyled">
                                            <li>
                                                <i class="fas fa-users"></i> Total des agents :
                                                <span class="badge badge-primary">{{ agents|length }}</span>
                                            </li>
                                            {# Ajoutez d'autres statistiques ici si nécessaire #}
                                        </ul>
                                    </div>
                                  </div>
                                  {# Ajoutez d'autres cartes ou graphiques ici si nécessaire #}
                              </div>

                              <div class="col-lg-9">
                                  <div class="card">
                                      <div class="card-header">
                                          <strong class="card-title">Liste des Agents</strong>
                                          <button class="btn btn-sm btn-success float-right" data-toggle="modal" data-target="#agentsModal">
                                              <i class="fa fa-plus"></i> Ajouter
                                          </button>
                                          {# TODO: Add filters modal for agents #}
                                          {#
                                          <button class="btn btn-sm btn-primary float-right" data-toggle="modal" data-target="#agentsFiltersModal">
                                              <i class="fa fa-filter"></i> Filtres
                                          </button>
                                          #}
                                      </div>
                                      <div class="card-body">
                                          <div class="table-responsive">
                                              <table class="table table-striped table-hover">
                                                  <thead>
                                                      <tr>
                                                          <th>Nom</th>
                                                          <th>Email</th>
                                                          {# Ajoutez d'autres colonnes si nécessaire #}
                                                          <th>Actions</th>
                                                      </tr>
                                                  </thead>
                                                  <tbody>
                                                      {% for agent in agents %}
                                                      <tr>
                                                          <td>{{ agent.name }}</td>
                                                          <td>{{ agent.email }}</td>
                                                          {# Affichez d'autres données de l'agent ici si nécessaire #}
                                                          <td>
                                                              <button class="btn btn-sm btn-danger delete-btn" data-id="{{ agent.id }}" data-type="agent" data-toggle="modal" data-target="#staticModal">
                                                                  <i class="fa fa-trash"></i> Supprimer
                                                              </button>
                                                          </td>
                                                      </tr>
                                                      {% endfor %}
                                                  </tbody>
                                              </table>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
{% include './modals/_agent_modal.html.twig' %}
{% import './infos/_macros.html.twig' as macros %}
{{ macros.static_modal('Confirmer la suppression', 'Voulez-vous vraiment supprimer cet élément ?') }}
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function() {
            $('#staticModal').on('show.bs.modal', function (event) {
                const button = $(event.relatedTarget); // Button that triggered the modal
                const itemId = button.data('id'); // Extract info from data-* attributes
                const itemType = button.data('type');

                const modal = $(this);
                modal.find('.modal-title').text('Confirmer la suppression d'un ' + itemType.charAt(0).toUpperCase() + itemType.slice(1));
                modal.find('.modal-body p').text('Voulez-vous vraiment supprimer cet ' + (itemType === 'agent' ? 'agent' : 'élément') + ' ?');

                // Set data attributes on the confirm button
                const confirmButton = modal.find('.btn-primary');
                confirmButton.data('id', itemId);
                confirmButton.data('type', itemType);
            });

            $('#staticModal .btn-primary').on('click', function() {
                const button = $(this);
                const itemId = button.data('id');
                const itemType = button.data('type');

                // TODO: Implement backend deletion request here
                console.log('Delete confirmed for item ID: ' + itemId + ' of type: ' + itemType);

                // Close the modal
                $('#staticModal').modal('hide');
            });
        });
    </script>
{% endblock %}
